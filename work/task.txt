# Phase G: Obsidian UX Parity (Workspace + Panels + Performance)

Match Obsidian's user experience for workspace layout and file watching.

## Context

Users expect Obsidian's workspace behavior:
- True split panes with persistence
- File watching that updates without manual reload
- Proper tab management

**Reference:** `docs/OBSIDIAN_COMPATIBILITY_AI_FIRST_ROADMAP.md` Phase G

## Goal

- Implement true workspace splits
- Add incremental file watching
- Persist workspace state correctly

---

## Task G1: Workspace Parity

### G1.1 Implement true splits

**Problem:** Current tab system doesn't support multiple panes.

**Files to modify:**
- `src/App.tsx`
- `src/stores/WorkspaceStateManager.ts`

**Actions:**
1. Add pane management (left/right splits)
2. Each pane has its own tab list
3. Active tab per pane
4. Split state persisted to workspace.json

**Success criteria:**
- [ ] Can create horizontal/vertical splits
- [ ] Each pane manages its own tabs
- [ ] Splits persist to workspace.json
- [ ] Can close individual panes

### G1.2 Tab persistence and behavior

**File to modify:** `src/stores/WorkspaceStateManager.ts`

**Implement:**
- Pin tabs (don't close on vault close)
- Tab history (last opened file per tab)
- New tab behavior (reuse vs create new)

**Success criteria:**
- [ ] Pinned tabs persist across sessions
- [ ] Tab history tracked correctly
- [ ] Opening file respects tab behavior settings

---

## Task G2: Performance + File Watching

### G2.1 Replace polling with filesystem watch

**Problem:** Current implementation may use polling or no watching.

**File to modify:** `src/hooks/useFileWatcher.ts` or `src/App.tsx`

**Actions:**
1. Use Tauri's file watch API if available
2. Fall back to intelligent polling if not
3. Debounce rapid changes
4. Trigger search index updates
5. Trigger file tree refresh

**Success criteria:**
- [ ] File changes trigger immediate UI updates
- [ ] No manual reload needed
- [ ] Rapid changes are debounced (don't reindex on every keystroke)
- [ ] Works for nested folders

### G2.2 Incremental search indexing

**File to modify:** `src/stores/searchStore.ts`

**Actions:**
1. Only re-index changed files
2. Remove deleted files from index
3. Add new files to index
4. Don't rebuild entire index on every change

**Success criteria:**
- [ ] File change updates index incrementally
- [ ] Deleted files removed from index
- [ ] New files added to index
- [ ] Index update is fast (< 100ms for single file)

---

## Task G3: Workspace JSON Format

### G3.1 Match Obsidian workspace.json format

**File to create or modify:** `src/stores/WorkspaceStateManager.ts`

**Implement Obsidian's structure:**
```json
{
  "main": {
    "x": 0, "y": 0, "width": 1000, "height": 800,
    "type": "split",
    "direction": "horizontal",
    "children": [
      {
        "type": "leaf",
        "id": "left-pane",
        "state": { "file": "Note.md" }
      },
      {
        "type": "leaf",
        "id": "right-pane",
        "state": { "file": "Other.md" }
      }
    ]
  }
}
```

**Success criteria:**
- [ ] Workspace uses Obsidian-compatible format
- [ ] Splits serialize correctly
- [ ] Can restore workspace from .obsidian/workspace.json
- [ ] Workspace is portable between Obsidian and Igne

---

## Task G4: Add Tests

### G4.1 Create workspace tests

**File to create:** `src/stores/__tests__/WorkspaceStateManager.test.ts`

**Test coverage:**
- [ ] Workspace serialization
- [ ] Workspace deserialization
- [ ] Split creation and removal
- [ ] Tab management within panes
- [ ] Pin tabs persistence

**Success criteria:**
- [ ] All tests pass
- [ ] Workspace state persists correctly

---

## Completion

When ALL tasks complete and tests pass, add this exact marker on its own line:

PROMISE_COMPLETE_TAG
